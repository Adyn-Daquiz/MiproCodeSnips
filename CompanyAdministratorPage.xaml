<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyProfessionals.Views.CompanyAdministratorPage"
             x:Name="CompanyAdminPage"
             Title="Company Administrators"
             BackgroundColor="{StaticResource PageBackgroundColor}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Assigned Employees Section -->
            <Label Text="Assigned Employees"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{StaticResource HeaderTextColor}" />

            <CollectionView ItemsSource="{Binding CompanyAdmins}"
                            HeightRequest="250"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="10"
                              Margin="0,5"
                              ColumnDefinitions="*,Auto"
                              BackgroundColor="{StaticResource CardBackgroundColor}">

                            <!-- Employee Info -->
                            <VerticalStackLayout Grid.Column="0" Spacing="2">
                                <Label Text="{Binding FullName}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource CardTextColor}" />
                                <Label Text="{Binding EmployeeType}"
                                       FontSize="14"
                                       TextColor="{StaticResource SubTextColor}" />
                            </VerticalStackLayout>

                            <!-- Remove Button -->
                            <Button Grid.Column="1"
                                    Text="Remove"
                                    Command="{Binding BindingContext.RemoveCommand, Source={x:Reference CompanyAdminPage}}"
                                    CommandParameter="{Binding Id}"
                                    BackgroundColor="{StaticResource CancelButtonBackgroundColor}"
                                    TextColor="{StaticResource CancelButtonTextColor}"
                                    CornerRadius="8"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Divider -->
            <BoxView HeightRequest="1"
                     Color="{StaticResource BorderColor}"
                     Margin="0,10"/>

            <!-- Add New Assignment Section -->
            <VerticalStackLayout Spacing="15">

                <Label Text="Add New Assignment"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{StaticResource HeaderTextColor}" />

                <!-- User Code Input -->
                <Entry Placeholder="Enter User Code"
                       Text="{Binding UserCodeInput}"
                       Keyboard="Text"
                       BackgroundColor="{StaticResource PrimaryBoxBackgroundColor}"
                       TextColor="{StaticResource PrimaryBoxTextColor}"
                       PlaceholderColor="{StaticResource PrimaryBoxTextPlaceholderColor}" />
                <Button Text="Search"
                        Command="{Binding SearchCommand}"
                        BackgroundColor="{StaticResource PrimaryButtonBackgroundColor}"
                        TextColor="{StaticResource PrimaryButtonTextColor}" />

                <!-- User Details -->
                <StackLayout IsVisible="{Binding SelectedUser, Converter={StaticResource NullToBoolConverter}}">
                    <Label Text="User Details"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource HeaderTextColor}" />

                    <Image Source="{Binding SelectedUser.ImageData, Converter={StaticResource ByteArrayToImageSourceConverter}}"
                           HeightRequest="100"
                           WidthRequest="100"
                           Aspect="AspectFill"
                           HorizontalOptions="Center" />

                    <Label Text="{Binding SelectedUser.FullName}"
                           FontSize="20"
                           HorizontalOptions="Center"
                           TextColor="{StaticResource CardTextColor}" />
                    <Label Text="{Binding SelectedUser.Email}"
                           FontAttributes="Italic"
                           HorizontalOptions="Center"
                           TextColor="{StaticResource SubTextColor}" />
                </StackLayout>

                <!-- Employee Type Picker -->
                <Label Text="Assign Employee Type:"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="{StaticResource CardTextColor}" />
                <Picker ItemsSource="{Binding CompanyEmployeeTypes}"
                        SelectedItem="{Binding SelectedEmployeeType}"
                        Title="Select Employee Type"
                        TextColor="{StaticResource CardTextColor}"
                        BackgroundColor="{StaticResource InnerCardBackgroundColor}" />

                <!-- Save Button -->
                <Button Text="Save Assignment"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding SelectedUser, Converter={StaticResource NullToBoolConverter}}"
                        BackgroundColor="{StaticResource CompleteButtonBackgroundColor}"
                        TextColor="{StaticResource CompleteButtonTextColor}" />
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
